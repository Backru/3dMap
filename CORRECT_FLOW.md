# 正确的交互流程

## 完整流程

### 1️⃣ 全国地图
- 显示所有省份和直辖市
- 点击任意省份 → 进入省级地图

### 2️⃣ 省级地图
- 显示该省的所有市
- 点击任意市 → 进入市级地图
- **特殊情况：直辖市**
  - 如果选择的是直辖市（北京、上海、天津、重庆）
  - 直接显示区县
  - 顶部显示"进入城市孪生"按钮

### 3️⃣ 市级地图
- 显示该市的所有区县
- **顶部显示按钮**：`🏙️ 进入 [城市名] 数字孪生`
- 点击按钮 → 进入城市数字孪生3D场景

### 4️⃣ 城市数字孪生
- 显示3D城市场景
- 左上角有"← 返回地图"按钮
- 点击返回 → 回到市级地图

## 流程图

### 普通省份
```
全国地图
   ↓ 点击省份（如：江苏省）
省级地图（显示：南京、苏州、无锡...）
   ↓ 点击市（如：南京市）
市级地图（显示：玄武区、秦淮区...）
   ↓ 点击顶部按钮
城市数字孪生 3D 场景
   ↓ 点击返回
市级地图
```

### 直辖市
```
全国地图
   ↓ 点击直辖市（如：北京市）
市级地图（显示：东城区、西城区...）
   ↓ 点击顶部按钮
城市数字孪生 3D 场景
   ↓ 点击返回
市级地图
```

## 按钮显示条件

### 顶部"进入城市孪生"按钮显示时机：
1. **市级地图** - 当 `mapLevel === 'city'` 且 `selectedCity` 有值
2. **直辖市** - 当 `mapLevel === 'province'` 且选中的是直辖市

### 按钮样式
- **尺寸**：紧凑型（padding: 10px 20px）
- **字体**：14px，中等粗细
- **图标**：18px 的城市图标 🏙️
- **颜色**：青色到蓝色渐变
- **效果**：
  - 光晕扫过动画
  - 悬停时上浮
  - 发光阴影

## 直辖市特殊处理

直辖市列表：
- 北京市
- 上海市
- 天津市
- 重庆市

这些城市在全国地图上点击后：
- 直接进入市级地图（显示区县）
- 跳过省级地图（因为直辖市没有"市"这一级）
- 立即显示"进入城市孪生"按钮

## 按钮位置

```
┌─────────────────────────────────────────┐
│                                         │
│  🏙️ 进入 南京市 数字孪生                 │ ← 顶部按钮（居中）
│                                         │
├─────────────────────────────────────────┤
│                                         │
│         [市级地图 - 显示所有区县]         │
│                                         │
│    鼠标悬停 → 显示数据卡片               │
│    点击顶部按钮 → 进入城市孪生           │
│                                         │
└─────────────────────────────────────────┘
```

## 关键代码逻辑

### 按钮显示条件
```vue
v-if="(mapLevel === 'city' && selectedCity) || 
      (mapLevel === 'province' && isDirectMunicipality)"
```

### 点击事件
```javascript
if (mapLevel.value === 'nation') {
  // 点击省份 → 进入省级地图
  onProvinceChange()
} else if (mapLevel.value === 'province') {
  // 点击市 → 进入市级地图
  onCityChange()
}
```

### 进入孪生
```javascript
enterCityTwinFromTop() {
  if (selectedCity.value) {
    enterCityTwin(selectedCity.value)
  } else if (selectedProvince.value) {
    // 直辖市情况
    enterCityTwin(selectedProvince.value)
  }
}
```

## 用户体验

1. **清晰的层级**：全国 → 省 → 市 → 孪生
2. **明确的提示**：顶部按钮清楚显示当前城市名称
3. **紧凑的设计**：按钮不会太大，不遮挡地图
4. **特殊处理**：直辖市自动适配，无需额外操作

这样的设计既保持了地图的层级结构，又提供了清晰的进入孪生场景的入口！
