# 城市数字孪生功能使用指南

## 功能说明

新增了城市数字孪生3D可视化功能，可以从地图视图切换到城市3D场景。

## 使用方法

### 1. 进入城市孪生模式

有两种方式进入城市孪生：

**方式一：通过数据卡片**
1. 在地图上选择一个省份（点击省份或使用下拉菜单）
2. 进入省级地图后，鼠标悬停在某个市上
3. 在弹出的数据卡片中，点击 **"🏙️ 进入城市孪生"** 按钮

**方式二：直接点击**
- 在省级地图上直接点击某个市，会显示数据卡片
- 点击数据卡片中的"进入城市孪生"按钮

### 2. 城市孪生功能

进入城市孪生后，你可以：

#### 视角控制
- **鼠标左键拖动**：旋转视角
- **鼠标右键拖动**：平移视角
- **鼠标滚轮**：缩放
- **点击"📷 重置视角"按钮**：恢复默认视角

#### 场景控制
- **🏢 建筑**：显示/隐藏城市建筑
- **🛣️ 道路**：显示/隐藏道路网络
- **💡 灯光**：显示/隐藏建筑窗户灯光
- **✨ 粒子**：显示/隐藏环境粒子效果

#### 时间控制
- 使用底部的时间滑块调整时间（0-24小时）
- 不同时间段会有不同的光照效果：
  - **白天（6:00-18:00）**：明亮的天空和强烈的阳光
  - **黄昏（18:00-20:00）**：橙红色的天空
  - **夜晚（20:00-6:00）**：深色天空，建筑灯光更明显

#### 城市信息
右上角显示城市的关键数据：
- 🏙️ 建筑数量
- 👥 人口
- 💰 GDP
- 🌡️ 温度

### 3. 返回地图

点击左上角的 **"← 返回地图"** 按钮返回到地图视图

## 技术特性

- **3D渲染**：使用 Three.js 实现的实时3D场景
- **动态光照**：根据时间变化的光照系统
- **粒子系统**：环境粒子效果
- **阴影效果**：建筑投射实时阴影
- **性能优化**：自适应像素比和LOD优化

## 自定义扩展

如果需要自定义城市场景，可以修改 `src/components/CityTwin.vue`：

- **建筑密度**：修改 `createCity()` 中的 `gridSize` 和 `spacing`
- **建筑样式**：修改 `createBuilding()` 中的几何体和材质
- **粒子效果**：修改 `createParticles()` 中的粒子数量和样式
- **光照效果**：修改 `setupLights()` 和 `updateTimeOfDay()` 中的光照参数

## 浏览器要求

- 需要支持 WebGL 的现代浏览器
- 推荐使用 Chrome、Firefox、Edge 最新版本
- 确保浏览器已启用硬件加速

## 故障排除

如果城市孪生场景无法显示：

1. 检查浏览器控制台是否有错误
2. 确认 WebGL 已启用（访问 chrome://gpu）
3. 尝试刷新页面
4. 检查显卡驱动是否为最新版本
